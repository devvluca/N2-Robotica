# ‚ö° Cheat Sheet - Rob√¥ Aspirador

Refer√™ncia r√°pida para desenvolvedores.

## üöÄ Comandos Principais

```bash
# Validar tudo
python validate.py

# Menu interativo com 6 exemplos
python examples.py

# Simula√ß√£o GUI (1 minuto)
python -c "
from src.robot_simulation import VacuumRobotSimulation
import yaml
config = yaml.safe_load(open('config/robot_config.yaml'))
sim = VacuumRobotSimulation(config, use_gui=True)
sim.initialize()
sim.run_execution(max_duration=60)
sim.shutdown()
"

# Simula√ß√£o headless r√°pida (10 segundos)
python -c "
from src.robot_simulation import VacuumRobotSimulation
import yaml
config = yaml.safe_load(open('config/robot_config.yaml'))
config['simulation']['gui_enabled'] = False
sim = VacuumRobotSimulation(config, use_gui=False)
sim.initialize()
m = sim.run_execution(30)
print(f'Coverage: {m.coverage_percentage:.1f}%')
sim.shutdown()
"

# Ciclos aprendizado (1-2 minutos)
python -c "
from src.robot_simulation import VacuumRobotSimulation
import yaml
config = yaml.safe_load(open('config/robot_config.yaml'))
sim = VacuumRobotSimulation(config, use_gui=False)
sim.initialize()
sim.run_learning_cycles(5)
sim.shutdown()
"
```

## üìù Snippets Python

### Executar uma limpeza

```python
from src.robot_simulation import VacuumRobotSimulation
import yaml

# Carregar config
with open('config/robot_config.yaml') as f:
    config = yaml.safe_load(f)

# Criar simulador
sim = VacuumRobotSimulation(config, use_gui=True)  # True=GUI, False=headless

# Inicializar
if not sim.initialize():
    print("Erro na inicializa√ß√£o")
    exit()

# Executar
try:
    metrics = sim.run_execution(max_duration=60.0)
    print(f"Cobertura: {metrics.coverage_percentage:.1f}%")
    print(f"Energia: {metrics.energy_consumed:.2f}J")
finally:
    sim.shutdown()
```

### M√∫ltiplos ciclos com aprendizado

```python
sim = VacuumRobotSimulation(config, use_gui=False)
sim.initialize()

# Rodar 5 ciclos, rob√¥ aprende melhor estrat√©gia
all_metrics = sim.run_learning_cycles(num_cycles=5)

for i, m in enumerate(all_metrics):
    print(f"Ciclo {i+1}: {m.coverage_percentage:.1f}%")

sim.shutdown()
```

### Usar estrat√©gia espec√≠fica

```python
sim = VacuumRobotSimulation(config, use_gui=False)
sim.initialize()

# Testar spiral
sim.navigation.set_exploration_strategy('spiral')
m1 = sim.run_execution(60)
print(f"Spiral: {m1.coverage_percentage:.1f}%")

# Resetar
sim.mapping.reset()
sim._reset_robot_position()

# Testar systematic
sim.navigation.set_exploration_strategy('systematic')
m2 = sim.run_execution(60)
print(f"Systematic: {m2.coverage_percentage:.1f}%")

sim.shutdown()
```

### Analisar dados salvos

```python
import pandas as pd
import numpy as np

# CSV da trajet√≥ria
df = pd.read_csv('logs/execution_20240115_120000.csv')
print(f"Dura√ß√£o: {df['time'].max():.1f}s")
print(f"Cobertura final: {df['coverage'].iloc[-1]:.1f}%")

# Grade de ocupa√ß√£o
grid = np.load('maps/occupancy_grid.npy')
print(f"Forma: {grid.shape}")
print(f"Ocupa√ß√£o: {grid.mean()*100:.1f}%")

# Rotas aprendidas
import json
data = json.load(open('maps/learned_routes.json'))
print(f"Melhor estrat√©gia: {data['best_strategy']}")
```

## üîß Editar Configura√ß√£o

```yaml
# config/robot_config.yaml

# Rob√¥ mais r√°pido
robot:
  max_linear_velocity: 1.0      # Era 0.5
  max_angular_velocity: 4.0     # Era 2.0

# Ambiente maior
environment:
  world_width: 15.0             # Era 10.0
  world_height: 12.0            # Era 8.0

# Mapa mais preciso (mais lento)
mapping:
  grid_resolution: 0.05         # Era 0.1

# Mais sensores
robot:
  sensors:
    count: 8                     # Era 5
    range: 1.5                   # Era 1.0

# Mais ciclos aprendizado
learning:
  max_iterations: 10            # Era 5

# Modo headless (sem GUI)
simulation:
  gui_enabled: false            # Era true
  time_step: 0.02               # Aumentar = mais r√°pido
```

## üìä Classes Principais

### VacuumRobotSimulation

```python
sim = VacuumRobotSimulation(config, use_gui=True)

# M√©todos principais
sim.initialize()                          # Setup completo
sim.run_execution(max_duration=60)        # Uma limpeza
sim.run_learning_cycles(num_cycles=5)    # M√∫ltiplos com aprendizado
sim.shutdown()                            # Limpeza

# Atributos
sim.robot_id                              # ID PyBullet
sim.current_coverage                      # % cobertura atual
sim.energy_consumed                       # Energia total
sim.trajectory                            # Lista de (t, x, y, heading)
sim.sensors                               # Dict de sensores
```

### MappingModule

```python
mapping = MappingModule(grid_resolution=0.1, world_width=10.0, world_height=8.0)

# M√©todos
mapping.process_sensor_data(x, y, heading, sensor_readings)
mapping.get_coverage_percentage()         # % coberto
mapping.get_uncovered_cells()             # N√∫mero c√©lulas vazias
mapping.get_mean_revisit_rate()           # Revisita m√©dia
mapping.get_map_image()                   # Imagem RGB
mapping.save()                            # Salvar em arquivo
mapping.load()                            # Carregar arquivo
mapping.reset()                           # Zerar mapa
```

### NavigationModule

```python
nav = NavigationModule(config)

# M√©todos
nav.compute_velocity(sensor_readings)     # (state, linear_vel, angular_vel)
nav.set_exploration_strategy(strategy)    # 'spiral', 'systematic', 'random'
nav.is_stuck()                            # Bool
```

### LearningModule

```python
learn = LearningModule(config)

# M√©todos
learn.record_execution(metrics)           # Registrar ciclo
learn.should_continue_learning()          # Bool (convergiu?)
learn.get_next_strategy()                 # Pr√≥xima estrat√©gia
learn.save_learning_data()                # Persistir JSON
learn.load_learning_data()                # Carregar JSON
```

### VacuumNodeREDClient

```python
client = VacuumNodeREDClient(host='localhost', port=1880)

# M√©todos
client.connect()                          # Testar conex√£o
client.send_telemetry(telemetry_obj)      # Enviar dados
client.send_metrics(metrics_obj)          # Enviar m√©tricas
client.start_async_sender()               # Thread background
client.stop_async_sender()                # Parar thread
client.disconnect()                       # Fechar conex√£o
client.get_status()                       # Status dict
```

## üìà Estrutura Dados Principais

### ExecutionMetrics

```python
from dataclasses import dataclass

@dataclass
class ExecutionMetrics:
    execution_id: int                  # N√∫mero da execu√ß√£o
    timestamp: str                     # ISO format
    duration: float                    # Segundos
    coverage_percentage: float         # 0-100
    energy_consumed: float             # Joules
    mean_revisit_rate: float           # [0, 1]
    uncovered_cells: int               # N√∫mero
    success: bool                      # coverage > 80%
```

### RobotTelemetry

```python
@dataclass
class RobotTelemetry:
    timestamp: str
    robot_id: str
    pose: Dict[str, float]             # {x, y, heading}
    sensor_readings: Dict[str, float]  # {sensor_0: dist, ...}
    velocity: Dict[str, float]         # {linear, angular}
    coverage_percentage: float
    energy_consumed: float
    state: str                         # IDLE/MOVING/AVOIDING
```

## üéØ Estrat√©gias de Explora√ß√£o

| Estrat√©gia | Descri√ß√£o | Cobertura | Tempo |
|-----------|-----------|-----------|-------|
| `spiral` | Espiral crescente | 85-90% | 45-60s |
| `systematic` | Linhas horizontais | 80-88% | 50-70s |
| `random` | Caminhada aleat√≥ria | 60-75% | 30-45s |

## üîç Debug

### Ver Logs Detalhados

```python
import logging
logging.basicConfig(level=logging.DEBUG)

# Rodar simula√ß√£o, muitos detalhes nos logs
sim = VacuumRobotSimulation(config)
sim.initialize()
```

### Verificar Sensores

```python
for name, sensor in sim.sensors.items():
    print(f"{name}: {sensor.read():.2f}m")
```

### Verificar Grade

```python
print(f"Grid shape: {sim.mapping.grid.shape}")
print(f"Mean occupancy: {sim.mapping.grid.mean():.3f}")
print(f"Coverage: {sim.mapping.get_coverage_percentage():.1f}%")
```

### Ver Status Completo

```python
summary = sim.get_summary()
print(summary)
```

## üìÅ Arquivos de Sa√≠da

```
logs/
  execution_20240115_120000.csv         # Trajet√≥ria
  execution_20240115_120015.csv         # Pr√≥xima execu√ß√£o

maps/
  occupancy_grid.npy                    # Grade
  learned_routes.json                   # Rotas otimizadas
```

## üêõ Erros Comuns

### ModuleNotFoundError
```bash
pip install pybullet==3.2.5 numpy pyyaml requests scipy
```

### YAML parse error
```bash
# Validar syntax YAML
python -c "import yaml; yaml.safe_load(open('config/robot_config.yaml'))"
```

### PyBullet GUI n√£o abre
```python
# Usar headless
sim = VacuumRobotSimulation(config, use_gui=False)
```

### Simula√ß√£o muito lenta
```yaml
# Aumentar time_step
simulation:
  time_step: 0.02  # Era 0.01
```

## ‚è±Ô∏è Tempos T√≠picos

```
Valida√ß√£o      : 2 seg
Inicializa√ß√£o  : 3 seg
1 passo f√≠sica : 0.01-0.05 seg
60s execu√ß√£o (GUI)     : 2-3 min real
60s execu√ß√£o (headless): 10-15 seg
5 ciclos aprendizado   : 1-2 min
```

## üìö Documenta√ß√£o

- `README.md` - Guia completo
- `QUICKSTART.md` - 5 minutos
- `NODE_RED_SETUP.md` - Integra√ß√£o
- `FILE_INDEX.md` - √çndice
- `PROJECT_SUMMARY.md` - Status

## üîó Recursos

- PyBullet: https://pybullet.org
- NumPy: https://numpy.org
- YAML: https://yaml.org
- Node-RED: https://nodered.org

---

**√öltima atualiza√ß√£o**: 2024-01-15

Mais d√∫vidas? Consulte `README.md` se√ß√£o "Troubleshooting"
